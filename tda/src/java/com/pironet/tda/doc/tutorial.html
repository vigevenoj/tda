<html>
<title>TDA - Thread Dump Analyzer Help Overview</title>
<link rel="stylesheet" type="text/css" href="stylesheet.css" title="Style">
<body>
<h2>TDA - Thread Dump Analyzer Overview</h2>
<h3>Introduction</h3>
<p>This is a short overview on how to use the TDA - Thread Dump Analyzer. TDA parses your log 
files and displays all found thread dumps and class histograms reported from a Sun JVM &gt;= 
1.4.x. Class Histograms are not included in the thread dumps by default but need a special 
JVM-Flag to be dumped with the thread dump. As TDA does everything offline and thread dumps 
have very low impact on the VM (including the class histogram option), it can be used for 
production environments. Note: There is a bug in early 1.5.x releases preventing the class 
histogram to be printed if any other than the concurrent mark sweep gc is used.
</p>

<p>
For having the class histograms included you need to provide the -XX:+PrintClassHistogram option
with the startup parameters of your application or application container.
</p>

<h3>Obtaining a thread dump at runtime</h3>
For getting a thread dump, you need to send a kill-QUIT-Signal to the Java VM, for this you 
need the PID of the VM and then do a <pre>kill -QUIT &lt;PID&gt;</pre> on a Unix Environment. 
If you use Windows, you need a special tool for accomplishing this, SendSignal, see References 
for this. It does the same like <pre>kill -QUIT</pre> on Windows-Systems. Beware: if you're 
using the remote connection on windows, you need to start the connection with <pre>mstsc.exe /console</pre> 
otherwise you won't have sufficient rights to use the tool. The JDK will then write the thread-dump 
to std-out. E.g. if your application is running in a tomcat, this would be catalina.out in a 
default tomcat installation.

<h3>Sample Parsing Session</h3>
<p>Open the log file you want to analyse, TDA will search for all thread dumps in this log file 
and displays them in a tree. As the Sun JVM thread dump doesn't log any date information when the dump 
was requested, you can provide a regular expression in the <b>Preferences</b> which is then used 
for parsing the lines before the thread dump to get a time stamp (see below for an example).</p>

<p>For each thread dump TDA sums up all found threads and all monitors found in the threads, it 
also groups threads waiting on, for and locking monitors.</p> 

<p><center><img src="threaddumps.png" border=0>
<br><i>Thread Dump View</i></center></p>

<p>If you want to focus on a lock found in a thread you can just mark it, expand the <b>Monitor</b> 
node of the thread dump and right-click on right pane with the monitors and select the search. Paste the marked monitor 
into the search dialog to go to the information about this monitor (don't forget the trailing &gt;. You will get all waiting and all 
locking threads of this monitor. Starting here you can easily see if a thread is hanging and holding lock which a lot 
of other threads are waiting for. If there aren't any locking threads but only waiting threads it is
very likely the garbage collector is locking the monitor currently.</p>
<p><center><img src="monitor.png" border=0>
<br><i>Monitors used by threads</i></center></p>

<p>If you added the -XX:+PrintClassHistogram to the VM-Parameters you will also see the class histogram 
for a thread dump, presented as node of the dump. Here you can examine all objects in the heap at the 
time of the thread dump. You can sort this view and filter it using the <b>Filter Expression</b>.</p>

<p><center><img src="histogram.png" border=0>
<br><i>Class Histogram of selected dump</i></center></p>

<p>If you use the loggc option with your VM to log the garbage collection information into a different log file, 
the heap dump will go into this log file instead of standard out and the TDA will not find it by default. To 
add the heap dump from a loggc file you need to use <b>Open loggc file...</b> in the popup menu of the thread dump pane. 
TDA will then parse this file backward and adds the found heap dumps to the thread dumps starting with the last dump. 
You can added multiple loggc-files, TDA will then continue after the last one where it added a heap dump 
with the last loggc-logfile. 
</p>

<p>If your log file contains a lot of thread dumps done during one session of the VM currently analyzed, 
you can use <b>Find long running threads</b> in the tools menu to extract long running threads from the 
thread dumps. Currently this does also show waiting thread, so you need to search for threads actually doing something</p>

<h3>Setting regular expression for timestamp parsing</h3>
<p>Because the Sun JDK doesn't provide any time information when dumping threads a regular expression time 
stamp parsing for each line in the log file is included. TDA matches every line to the regular expression 
given in the preferences and stores the first matching group if the regular expression matches the line. 
It then takes the last match found as time stamp for the next thread dump to get a time stamp nearest to the 
thread dump. An example for such a regular expression is <i>(\d\d\/\d\d\/\d\d\s\d\d:\d\d:\d\d).*</i>. This 
expression matches lines like <i>06/02/14 14:54:04       at java.lang.Thread.run(Thread.java:534)</i>. TDA 
then takes the first capturing group as time stamp. In this example the \d is for digits and the capturing 
group is included in the brackets and matches <i>06/02/14 14:54:04</i>. This is then stored as timestamp 
for the next thread dump. </p>

<p>If the timestamp is stored in milliseconds since 1970 there is a checkbox in the preferences <i>Parsed 
timestamp is a long representing msecs since 1970</i> to tell TDA to convert the parsed time stamp from 
milliseconds into a human readable time stamp.</p> See References for detailed information about the regular 
expressions in java.

<h3>Using filters</h3>
<p>To filter out sleeping and uninteresting threads in your view you can use filters to just ignore these threads. For example 
if you use jgroups in your application and don't want to see als the STACKs and QUEUEs of jgroups you can specify 
something like that seen in the next screenshot.

<p><center><img src="filters.png" border=0>
<br><i>Filter filtering jgroups threads</i></center></p>

<p>The status bar will provide information about the number of filtered threads and how many are remaining. Note that changes
to the filters are only after you changed a view. The filter changes will not be applied to the currently displayed thread view.</p>

<p>Filters can be used to match different parts of the thread information. You can match or search in stack, title and you can 
check for the thread state the thread is in. Filters can be including or excluding. The example above is a excluding
filter which checks if org.jgroups is in the stack information of a thread.</p>

<h3>References</h3>
<p>For further offline analysis you can use the GC-Viewer found below. If you want to go one step further 
and do an online analysis with low impact on your (production) environment, you should have a look at the 
Glassbox Inspector.</p> 
<ul>
<li><a href="http://www.tagtraum.com/gcviewer.html">GC-Viewer</a> (http://www.tagtraum.com/gcviewer.html)
<li><a href="http://glassbox-inspector.dev.java.net/">Glassbox Inspector</a> (http://glassbox-inspector.dev.java.net/)
<li><a href="http://java.sun.com/j2se/1.4.2/docs/api/index.html">Java API Specification 1.4.2</a> (for regular expressions look for <b>Pattern</b> class.)<br>
(http://java.sun.com/j2se/1.4.2/docs/api/index.html)
<li><a href="http://www.latenighthacking.com/projects/2003/sendSignal/">SendSignal</a> (http://www.latenighthacking.com/projects/2003/sendSignal/)
</ul>
</body>
</html>
